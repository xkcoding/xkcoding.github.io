<!DOCTYPE html><html class="theme-next muse use-motion" lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2"><link rel="stylesheet" href="/lib/Han/dist/han.min.css?v=3.3"><meta name="google-site-verification" content="1QzehZlTl5aSnOCNs73zcBTKES4VP3lD03D9KydmKEE"><meta name="msvalidate.01" content="8BF7F99E04BB8024BEA713E231B70D39"><meta name="baidu-site-verification" content="GQoVEswEhI"><link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2"><link rel="stylesheet" href="/css/main.css?v=7.0.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.png?v=7.0.0"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.png?v=7.0.0"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.png?v=7.0.0"><link rel="mask-icon" href="/favicon.png?v=7.0.0" color="#222"><script>!function(e,t,o,a,c,i,n){e.DaoVoiceObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,i=t.createElement(o),n=t.getElementsByTagName(o)[0],i.async=1,i.src=a,i.charset="utf-8",n.parentNode.insertBefore(i,n)}(window,document,"script",("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/0f81ff2f.js","daovoice"),daovoice("init",{app_id:"80a62a84"}),daovoice("update")</script><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",version:"7.0.0",sidebar:{position:"left",width:240,display:"always",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1,dimmer:!1},copycode:{enable:!0,show_result:!0,style:"mac"},fancybox:!0,fastclick:!0,lazyload:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"ZV4RFZVZ58",apiKey:"ad1e0a485cd7b9e16a583282fc2843c6",indexName:"xkcoding",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="ElasticSearch是一个基于 Lucene 的分布式搜索引擎，业内简称ES。它提供了基于 RESTful 风格的全文搜索API。Elasticsearch 是用 Java 开发的，并作为 Apache 许可条款下的开放源码发布，是当前最流行的企业级搜索引擎。另外，它的分布式设计让它天生就适合用于云计算中，并能够达到准实时搜索，而且安装使用方便，还拥有稳定，可靠，快速等特性。本文是我对 ES"><meta name="keywords" content="java,elasticsearch"><meta property="og:type" content="article"><meta property="og:title" content="ElasticSearch 笔记"><meta property="og:url" content="https://xkcoding.com/2018/01/12/elasticsearch_note.html"><meta property="og:site_name" content="CodingDiary"><meta property="og:description" content="ElasticSearch是一个基于 Lucene 的分布式搜索引擎，业内简称ES。它提供了基于 RESTful 风格的全文搜索API。Elasticsearch 是用 Java 开发的，并作为 Apache 许可条款下的开放源码发布，是当前最流行的企业级搜索引擎。另外，它的分布式设计让它天生就适合用于云计算中，并能够达到准实时搜索，而且安装使用方便，还拥有稳定，可靠，快速等特性。本文是我对 ES"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://static.xkcoding.com/2018-01-12-15157443065618.jpg"><meta property="og:image" content="https://static.xkcoding.com/2018-01-12-15157518741687.jpg"><meta property="og:image" content="https://static.xkcoding.com/2018-01-12-15157472517495.jpg"><meta property="og:image" content="https://static.xkcoding.com/2018-01-17-15161702463041.jpg"><meta property="og:image" content="https://static.xkcoding.com/2018-01-17-15161719204773.jpg"><meta property="og:image" content="https://static.xkcoding.com/2018-01-17-15161725779321.jpg"><meta property="og:image" content="https://static.xkcoding.com/2018-01-17-15161727420397.jpg"><meta property="og:image" content="https://static.xkcoding.com/2018-01-17-15161741012942.jpg"><meta property="og:image" content="https://static.xkcoding.com/2018-01-17-15161767712389.jpg"><meta property="og:updated_time" content="2022-10-04T22:31:35.222Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="ElasticSearch 笔记"><meta name="twitter:description" content="ElasticSearch是一个基于 Lucene 的分布式搜索引擎，业内简称ES。它提供了基于 RESTful 风格的全文搜索API。Elasticsearch 是用 Java 开发的，并作为 Apache 许可条款下的开放源码发布，是当前最流行的企业级搜索引擎。另外，它的分布式设计让它天生就适合用于云计算中，并能够达到准实时搜索，而且安装使用方便，还拥有稳定，可靠，快速等特性。本文是我对 ES"><meta name="twitter:image" content="https://static.xkcoding.com/2018-01-12-15157443065618.jpg"><link rel="alternate" href="/atom.xml" title="CodingDiary" type="application/atom+xml"><link rel="canonical" href="https://xkcoding.com/2018/01/12/elasticsearch_note.html"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>ElasticSearch 笔记 | CodingDiary</title><script async src="//www.googletagmanager.com/gtag/js?id=[object Object]"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","[object Object]")</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?521f6d48d3fa40ce529ba993fc1a46b4";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">CodingDiary</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">代码日记</h1></div><div class="site-nav-toggle"> <button aria-label="切换导航栏"><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类<span class="badge">39</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签<span class="badge">57</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档<span class="badge">86</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-sitemap"><a href="/atom.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>站点地图</a></li><li class="menu-item menu-item-wiki"><span class="exturl" data-url="aHR0cHM6Ly94a2NvZGluZy53aWtp"><i class="menu-item-icon fa fa-fw fa-code"></i><br>wiki</span></li><li class="menu-item menu-item-阅读"><span class="exturl" data-url="aHR0cHM6Ly9yZWFkaW5nLnhrY29kaW5nLmNvbQ=="><i class="menu-item-icon fa fa-fw fa-book"></i><br>阅读</span></li><li class="menu-item menu-item-友链"><a href="/links" rel="section"><i class="menu-item-icon fa fa-fw fa-link"></i><br>友链</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header> <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hrY29kaW5n" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#222;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></span><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><div class="reading-progress-bar"></div><article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://xkcoding.com/2018/01/12/elasticsearch_note.html"><span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="name" content="xkcoding"><meta itemprop="description" content="xkcoding的代码成长日记"><meta itemprop="image" content="/images/avatar.png"></span><span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="CodingDiary"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">ElasticSearch 笔记<span class="exturl post-edit-link" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hrY29kaW5nL015QmxvZy9lZGl0L21hc3Rlci9zb3VyY2UvX3Bvc3RzLzIwMTgtMDEtMTIuZWxhc3RpY3NlYXJjaC1ub3RlLm1k" title="编辑"><i class="fa fa-pencil"></i></span></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-01-12 17:11:18" itemprop="dateCreated datePublished" datetime="2018-01-12T17:11:18+08:00">2018-01-12</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/技术相关/" itemprop="url" rel="index"><span itemprop="name">技术相关</span></a></span> ， <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/技术相关/elasticsearch/" itemprop="url" rel="index"><span itemprop="name">elasticsearch</span></a></span></span> <span id="/2018/01/12/elasticsearch_note.html" class="leancloud_visitors" data-flag-title="ElasticSearch 笔记"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><div class="post-symbolscount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">本文字数：</span> <span title="本文字数">20k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">18 分钟</span></div></div></header><div class="post-body han-init-context" itemprop="articleBody"><p><code>ElasticSearch</code>是一个基于 <code>Lucene</code> 的分布式搜索引擎，业内简称ES。它提供了基于 <code>RESTful</code> 风格的全文搜索API。<code>Elasticsearch</code> 是用 <code>Java</code> 开发的，并作为 <code>Apache</code> 许可条款下的开放源码发布，是当前最流行的企业级搜索引擎。另外，它的分布式设计让它天生就适合用于云计算中，并能够达到准实时搜索，而且安装使用方便，还拥有稳定，可靠，快速等特性。本文是我对 ES 的一个完整记录，方便后期查阅。另外大家还可以查阅更多的相关资料对 <code>ElasticSearch</code> 有更深入的了解。</p><a id="more"></a><h2 id="1-安装"><a class="header-anchor" href="#1-安装"></a>1. 安装</h2><h3 id="1-1-单机安装"><a class="header-anchor" href="#1-1-单机安装"></a>1.1. 单机安装</h3><blockquote><p>ElasticSearch 要求本地的 JDK 版本不低于<strong>1.8</strong></p></blockquote><ol><li><p>去官网下载最新版的 ES 软件包 <span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9kb3dubG9hZHMvZWxhc3RpY3NlYXJjaA==" title="https://www.elastic.co/downloads/elasticsearch">https://www.elastic.co/downloads/elasticsearch<i class="fa fa-external-link"></i></span> ，目前 ES 最新版本为6.1.1，我这里采用 wget 命令在终端下载</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd apps</span><br><span class="line">wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.1.1.tar.gz</span><br></pre></td></tr></table></figure></li><li><p>如果出现 <code>command not found: wget</code>，如果是 Linux，可以用 <code>yum install -y wget</code> 下载，如果是 Mac 就可以用 <code>brew install wget</code> 下载</p></li><li><p>检查本地 JDK 版本，必须保证为<strong>1.8</strong>版本以上</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> java -version</span></span><br><span class="line">java version "1.8.0_131"</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_131-b11)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.131-b11, mixed mode)</span><br></pre></td></tr></table></figure></li><li><p>解压软件包</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf elasticsearch-<span class="number">6.1</span>.1.tar.gz</span><br></pre></td></tr></table></figure></li><li><p>启动 ES</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd elasticsearch-6.1.1</span><br><span class="line">./bin/elasticsearch</span><br></pre></td></tr></table></figure></li><li><p>测试，打开 PostMan 测试 <span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo5MjAw" title="http://localhost:9200">http://localhost:9200<i class="fa fa-external-link"></i></span> ，查看返回的 JSON 信息</p><p><img src="https://static.xkcoding.com/2018-01-12-15157443065618.jpg" alt="PostMan测试单机部署结果"></p></li></ol><h3 id="1-2-分布式安装"><a class="header-anchor" href="#1-2-分布式安装"></a>1.2. 分布式安装</h3><p>这里我会在本地启动3个 ES 节点，分别用不同的端口号来模拟分布式的环境，一个节点为 master，另外两个节点为 slave 节点。</p><ol><li><p>下载安装包，解压3份，分别命名为 <code>elasticsearch-master</code>，<code>elasticsearch-slave1</code>，<code>elasticsearch-slave2</code></p></li><li><p>修改 <code>elasticsearch-master</code> 的配置文件，<code>config/elasticsearch.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="string">http.cors.allow-origin:</span> <span class="string">"*"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 用于指定集群名称</span></span><br><span class="line"><span class="string">cluster.name:</span> <span class="string">xkcoding</span></span><br><span class="line"><span class="comment">## 用于指定节点名称</span></span><br><span class="line"><span class="string">node.name:</span> <span class="string">master</span></span><br><span class="line"><span class="comment">## 用于指定当前节点是 master 节点</span></span><br><span class="line"><span class="string">node.master:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="string">network.host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"><span class="string">http.port:</span> <span class="number">9200</span></span><br></pre></td></tr></table></figure></li><li><p>修改 <code>elasticsearch-slave1</code> 的配置文件，<code>config/elasticsearch.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="string">http.cors.allow-origin:</span> <span class="string">"*"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 用于指定集群名称</span></span><br><span class="line"><span class="string">cluster.name:</span> <span class="string">xkcoding</span></span><br><span class="line"><span class="comment">## 用于指定节点名称</span></span><br><span class="line"><span class="string">node.name:</span> <span class="string">slave1</span></span><br><span class="line"></span><br><span class="line"><span class="string">network.host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"><span class="string">http.port:</span> <span class="number">8200</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 用于发现 master 节点</span></span><br><span class="line"><span class="string">discovery.zen.ping.unicast.hosts:</span> <span class="string">["127.0.0.1"]</span></span><br></pre></td></tr></table></figure></li><li><p>修改 <code>elasticsearch-slave2</code> 的配置文件，<code>config/elasticsearch.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="string">http.cors.allow-origin:</span> <span class="string">"*"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 用于指定集群名称</span></span><br><span class="line"><span class="string">cluster.name:</span> <span class="string">xkcoding</span></span><br><span class="line"><span class="comment">## 用于指定节点名称</span></span><br><span class="line"><span class="string">node.name:</span> <span class="string">slave2</span></span><br><span class="line"></span><br><span class="line"><span class="string">network.host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"><span class="string">http.port:</span> <span class="number">7200</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 用于发现 master 节点</span></span><br><span class="line"><span class="string">discovery.zen.ping.unicast.hosts:</span> <span class="string">["127.0.0.1"]</span></span><br></pre></td></tr></table></figure></li><li><p>启动 head 插件，打开浏览器，访问 <span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo5MTAw" title="http://localhost:9100">http://localhost:9100<i class="fa fa-external-link"></i></span>，查看分布式节点的运行状态</p><p><img src="https://static.xkcoding.com/2018-01-12-15157518741687.jpg" alt="分布式 ES 的集群状态"></p></li></ol><h3 id="1-3-插件安装"><a class="header-anchor" href="#1-3-插件安装"></a>1.3. 插件安装</h3><h4 id="1-3-1-head-插件"><a class="header-anchor" href="#1-3-1-head-插件"></a>1.3.1. head 插件</h4><h5 id="独立安装"><a class="header-anchor" href="#独立安装"></a>独立安装</h5><blockquote><p>独立安装是指，head插件安装在es外部，<br> 独立安装 head 插件，要求本地的 Node 版本不低于8.0</p></blockquote><ol><li><p>前往 GitHub 搜索 <code>elasticsearch-head</code> ，这里我直接给出插件的 GitHub 仓库地址，<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21vYnovZWxhc3RpY3NlYXJjaC1oZWFk" title="https://github.com/mobz/elasticsearch-head">https://github.com/mobz/elasticsearch-head<i class="fa fa-external-link"></i></span> ，clone 源代码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/apps</span><br><span class="line">git clone https://github.com/mobz/elasticsearch-head.git</span><br></pre></td></tr></table></figure></li><li><p>检查本地 Node 版本，必须保证为<strong>8.0</strong>版本以上</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node -v</span></span><br><span class="line">v8.5.0</span><br></pre></td></tr></table></figure></li><li><p>编译 head 插件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/apps/elasticsearch-head</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure><blockquote><p>如果觉得这一步的依赖下载比较慢的话，有两种解决方式：</p><ol><li>可以选择科学上网</li><li>使用国内阿里的镜像源，使用 cnpm 安装，具体如何配置，本文不做赘述。具体参考：<span class="exturl" data-url="aHR0cDovL25wbS50YW9iYW8ub3JnLw==" title="http://npm.taobao.org/">http://npm.taobao.org/<i class="fa fa-external-link"></i></span></li></ol></blockquote></li><li><p>配置 ES 支持跨域访问，让 head 插件可以访问到</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/apps/elasticsearch-6.1.1</span><br><span class="line">vim config/elasticsearch.yml</span><br></pre></td></tr></table></figure><p>添加进下面两行对跨域的配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="string">http.cors.allow-origin:</span> <span class="string">"*"</span></span><br></pre></td></tr></table></figure><p>保存 <code>:wq!</code> 配置文件，启动 ES</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/elasticsearch</span><br></pre></td></tr></table></figure></li><li><p>运行 head 插件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/apps/elasticsearch-head</span><br><span class="line">npm run start</span><br></pre></td></tr></table></figure></li><li><p>打开浏览器，访问 <span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo5MTAwLw==" title="http://localhost:9100/">http://localhost:9100/<i class="fa fa-external-link"></i></span> ，查看 head 插件运行效果</p><p><img src="https://static.xkcoding.com/2018-01-12-15157472517495.jpg" alt="运行 head 插件，查看单机 ES 状态"></p></li></ol><h5 id="集成安装"><a class="header-anchor" href="#集成安装"></a>集成安装</h5><blockquote><p>ES 版本 5.x 以上，不支持这种方式安装，如果想使用head插件，请使用独立安装</p></blockquote><ol><li><p>使用ES提供的插件安装方式安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/plugin install mobz/elasticsearch-head</span><br></pre></td></tr></table></figure></li><li><p>打开浏览器，访问 <span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo5MjAwL19wbHVnaW4vaGVhZC8=" title="http://localhost:9200/_plugin/head/">http://localhost:9200/_plugin/head/<i class="fa fa-external-link"></i></span> ，查看 head 插件运行效果</p></li></ol><h4 id="1-3-2-ik-中文分词插件"><a class="header-anchor" href="#1-3-2-ik-中文分词插件"></a>1.3.2. ik 中文分词插件</h4><blockquote><p>ik 分词插件版本与ES版本对照，请查阅：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21lZGNsL2VsYXN0aWNzZWFyY2gtYW5hbHlzaXMtaWsjdmVyc2lvbnM=" title="https://github.com/medcl/elasticsearch-analysis-ik#versions">https://github.com/medcl/elasticsearch-analysis-ik#versions<i class="fa fa-external-link"></i></span></p></blockquote><h5 id="手动安装"><a class="header-anchor" href="#手动安装"></a>手动安装</h5><ol><li><p>在 ES 的 plugins 目录下创建 ik 目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ./plugins &amp;&amp; mkdir ik</span><br></pre></td></tr></table></figure></li><li><p>下载编译包到 ik 目录，下载地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21lZGNsL2VsYXN0aWNzZWFyY2gtYW5hbHlzaXMtaWsvcmVsZWFzZXM=" title="https://github.com/medcl/elasticsearch-analysis-ik/releases">https://github.com/medcl/elasticsearch-analysis-ik/releases<i class="fa fa-external-link"></i></span></p></li><li><p>解压下载的压缩包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip elasticsearch-analysis-ik-&#123; ES 版本 &#125;.zip</span><br></pre></td></tr></table></figure></li><li><p>重启 ES</p></li></ol><h5 id="自动安装"><a class="header-anchor" href="#自动安装"></a>自动安装</h5><ol><li><p>使用 ES 提供的插件安装方式安装，替换下面的ES 版本，具体信息可以去 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21lZGNsL2VsYXN0aWNzZWFyY2gtYW5hbHlzaXMtaWsvcmVsZWFzZXM=" title="https://github.com/medcl/elasticsearch-analysis-ik/releases">https://github.com/medcl/elasticsearch-analysis-ik/releases<i class="fa fa-external-link"></i></span> 查看</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/&#123; ES 版本 &#125;/elasticsearch-analysis-ik-&#123; ES 版本 &#125;.zip</span><br></pre></td></tr></table></figure></li><li><p>重启 ES</p></li></ol><hr><h2 id="2-常见错误"><a class="header-anchor" href="#2-常见错误"></a>2. 常见错误</h2><h3 id="错误1：进程虚拟内存"><a class="header-anchor" href="#错误1：进程虚拟内存"></a>错误1：进程虚拟内存</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[3]: max virtual memory areas vm.max_map_count [65530] likely too low, increase to at least [262144]</span><br></pre></td></tr></table></figure><p>vm.max_map_count：限制一个进程可以拥有的VMA(虚拟内存区域)的数量。</p><p>切换到root用户，修改配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysctl.conf</span><br></pre></td></tr></table></figure><p>添加下面的内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.max_map_count=655360</span><br></pre></td></tr></table></figure><p>然后执行命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><h3 id="错误2：文件权限不足"><a class="header-anchor" href="#错误2：文件权限不足"></a>错误2：文件权限不足</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1]: max file descriptors [4096] <span class="keyword">for</span> elasticsearch process likely too low, increase to at least [65536]</span><br></pre></td></tr></table></figure><p>用的是es用户，而不是root，所以文件权限不足。</p><p><strong>使用root用户登录</strong></p><p>修改配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/security/limits.conf</span><br></pre></td></tr></table></figure><p>添加下面的内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* soft nofile 65536</span><br><span class="line"></span><br><span class="line">* hard nofile 131072</span><br><span class="line"></span><br><span class="line">* soft nproc 4096</span><br><span class="line"></span><br><span class="line">* hard nproc 4096</span><br></pre></td></tr></table></figure><h3 id="重启终端窗口"><a class="header-anchor" href="#重启终端窗口"></a>重启终端窗口</h3><p>所有错误修改完毕，一定要重启你的终端，否则配置无效。</p><hr><h2 id="3-基础概念"><a class="header-anchor" href="#3-基础概念"></a>3. 基础概念</h2><h3 id="3-1-集群和节点"><a class="header-anchor" href="#3-1-集群和节点"></a>3.1. 集群和节点</h3><p>每个节点都是一个 ES 的单独实例，通过 node_name 来指定各个节点的名字。</p><p>集群是通过配置cluster_name来使得节点找到集群。</p><h3 id="3-2-索引"><a class="header-anchor" href="#3-2-索引"></a>3.2. 索引</h3><p>索引是含有相同属性的文档集合，在 ES 中是通过一个名字来识别的，而且要求是<span style="color:red"><strong>英文字母小写且不包含中划线</strong></span></p><p>索引对应于 SQL 的 database</p><h3 id="3-3-类型"><a class="header-anchor" href="#3-3-类型"></a>3.3. 类型</h3><p>索引可以含有一个或者多个类型，文档必须属于一个类型</p><p>类型对应于 SQL 的 table</p><h3 id="3-4-文档"><a class="header-anchor" href="#3-4-文档"></a>3.4. 文档</h3><p>文档是可以被索引的基本数据单位</p><p>文档对应于 SQL 的一条记录</p><h3 id="3-5-分片"><a class="header-anchor" href="#3-5-分片"></a>3.5. 分片</h3><p>每个索引都有多个分片，每个分片都是一个 Lucene 索引</p><h3 id="3-6-备份"><a class="header-anchor" href="#3-6-备份"></a>3.6. 备份</h3><p>拷贝一份分片就完成了分片的备份</p><hr><h2 id="4-基本用法"><a class="header-anchor" href="#4-基本用法"></a>4. 基本用法</h2><h3 id="4-1-请求方式"><a class="header-anchor" href="#4-1-请求方式"></a>4.1. 请求方式</h3><p>API 基本格式：<code>http://&lt;ip&gt;:&lt;port&gt;/&lt;索引&gt;/&lt;类型&gt;/&lt;文档 id&gt;</code></p><p>API 请求方式：GET、POST、PUT、DELETE</p><h3 id="4-2-索引"><a class="header-anchor" href="#4-2-索引"></a>4.2. 索引</h3><h4 id="创建"><a class="header-anchor" href="#创建"></a>创建</h4><p>假设创建一个 people 的索引，打开 PostMan，输入地址 <span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo5MjAwL3Blb3BsZQ==" title="http://localhost:9200/people">http://localhost:9200/people<i class="fa fa-external-link"></i></span> ，将方法改为 <span style="color:red">PUT</span> 方法，将👇的 json 放入 Body 请求体，点击 Send，若出现 <code>&quot;acknowledged&quot;:true</code>，则代表索引创建成功。</p><p>请求体的 json:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"settings"</span>:&#123;</span><br><span class="line">		<span class="attr">"number_of_shards"</span>:<span class="number">3</span>,</span><br><span class="line">		<span class="attr">"number_of_replicas"</span>:<span class="number">1</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"mappings"</span>:&#123;</span><br><span class="line">		<span class="attr">"person"</span>:&#123;</span><br><span class="line">			<span class="attr">"properties"</span>:&#123;</span><br><span class="line">				<span class="attr">"name"</span>:&#123;</span><br><span class="line">					<span class="attr">"type"</span>:<span class="string">"text"</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"age"</span>:&#123;</span><br><span class="line">					<span class="attr">"type"</span>:<span class="string">"integer"</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"country"</span>:&#123;</span><br><span class="line">					<span class="attr">"type"</span>:<span class="string">"keyword"</span></span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">"birthday"</span>:&#123;</span><br><span class="line">					<span class="attr">"type"</span>:<span class="string">"date"</span>,</span><br><span class="line">					<span class="attr">"format"</span>:<span class="string">"yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis"</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note success"><p><strong>json 请求体字段解释：</strong></p><ol><li>settings 字段可以不指定</li><li>number_of_shards 代表分片数（默认为5）</li><li>number_of_replicas 代表备份数（默认为1）</li><li>text 类型的字段搜索时将会被分词</li><li>keyword 类型的字段搜索时将不会被分词</li><li>epoch_millis 类型代表时间戳格式</li></ol></div><p>返回值：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"acknowledged"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"shards_acknowledged"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"index"</span>: <span class="string">"people"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如图所示：</p><p><img src="https://static.xkcoding.com/2018-01-17-15161702463041.jpg" alt="创建索引"></p><h4 id="删除"><a class="header-anchor" href="#删除"></a>删除</h4><p>打开 PostMan，输入地址 <span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo5MjAwL3Blb3BsZQ==" title="http://localhost:9200/people">http://localhost:9200/people<i class="fa fa-external-link"></i></span> ，将方法改为 <span style="color:red">DELETE</span> 方法，点击 Send。</p><p>返回值：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"acknowledged"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3-插入"><a class="header-anchor" href="#4-3-插入"></a>4.3. 插入</h3><p>现在我们向之前创建的类型中添加一条文档记录，插入分为2种方式，一种是指定 ID，一种是不指定 ID，当不指定 ID 时，ID 由 ES 生成。</p><h4 id="指定-ID-插入"><a class="header-anchor" href="#指定-ID-插入"></a>指定 ID 插入</h4><p>打开 PostMan，输入地址 <span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo5MjAwL3Blb3BsZS9wZXJzb24vMQ==" title="http://localhost:9200/people/person/1">http://localhost:9200/people/person/1<i class="fa fa-external-link"></i></span> ，将文档的 json 放入 Body 请求体，将方法改为 <span style="color:red">PUT</span> 方法，点击 Send。</p><p>文档内容：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"name"</span>:<span class="string">"xkcoding"</span>,</span><br><span class="line">	<span class="attr">"age"</span>:<span class="number">24</span>,</span><br><span class="line">	<span class="attr">"country"</span>:<span class="string">"中国"</span>,</span><br><span class="line">	<span class="attr">"birthday"</span>:<span class="string">"1994-11-22"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>返回值：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"_index"</span>: <span class="string">"people"</span>,</span><br><span class="line">    <span class="attr">"_type"</span>: <span class="string">"person"</span>,</span><br><span class="line">    <span class="attr">"_id"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="attr">"_version"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"result"</span>: <span class="string">"created"</span>,</span><br><span class="line">    <span class="attr">"_shards"</span>: &#123;</span><br><span class="line">        <span class="attr">"total"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"successful"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"_seq_no"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"_primary_term"</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如图所示：</p><p><img src="https://static.xkcoding.com/2018-01-17-15161719204773.jpg" alt="指定 id 插入"></p><h4 id="不指定-ID-插入"><a class="header-anchor" href="#不指定-ID-插入"></a>不指定 ID 插入</h4><p>打开 PostMan，输入地址 <span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo5MjAwL3Blb3BsZS9wZXJzb24=" title="http://localhost:9200/people/person">http://localhost:9200/people/person<i class="fa fa-external-link"></i></span> ，将文档的 json 放入 Body 请求体，将方法改为 <span style="color:red">POST</span> 方法，点击 Send。</p><p>文档内容：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"name"</span>:<span class="string">"中年xkcoding"</span>,</span><br><span class="line">	<span class="attr">"age"</span>:<span class="number">34</span>,</span><br><span class="line">	<span class="attr">"country"</span>:<span class="string">"中国"</span>,</span><br><span class="line">	<span class="attr">"birthday"</span>:<span class="string">"1984-11-22"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>返回值：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"_index"</span>: <span class="string">"people"</span>,</span><br><span class="line">    <span class="attr">"_type"</span>: <span class="string">"person"</span>,</span><br><span class="line">    <span class="attr">"_id"</span>: <span class="string">"I4_sAmEBVnl1iCRF78pG"</span>,</span><br><span class="line">    <span class="attr">"_version"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"result"</span>: <span class="string">"created"</span>,</span><br><span class="line">    <span class="attr">"_shards"</span>: &#123;</span><br><span class="line">        <span class="attr">"total"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"successful"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"_seq_no"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"_primary_term"</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如图所示：</p><p><img src="https://static.xkcoding.com/2018-01-17-15161725779321.jpg" alt="不指定 id 插入"></p><p>然后前往 head 插件查看是否插入数据</p><p><img src="https://static.xkcoding.com/2018-01-17-15161727420397.jpg" alt="head 插件中查看添加的文档记录"></p><h3 id="4-4-修改"><a class="header-anchor" href="#4-4-修改"></a>4.4. 修改</h3><p>修改文档数据，打开 PostMan，输入地址 <span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo5MjAwL3Blb3BsZS9wZXJzb24vMS9fdXBkYXRl" title="http://localhost:9200/people/person/1/_update">http://localhost:9200/people/person/1/_update<i class="fa fa-external-link"></i></span> ，将请求的 json 放入 Body 请求体，将方法改为 <span style="color:red">POST</span> 方法，点击 Send。</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"doc"</span>:&#123;</span><br><span class="line">		<span class="attr">"name"</span>:<span class="string">"沈扬凯"</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note danger"><p>注意：修改的时候 URL 必须后面跟_update，然后要修改的字段必须放在 doc 字段里。</p></div><p>返回值：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"_index"</span>: <span class="string">"people"</span>,</span><br><span class="line">    <span class="attr">"_type"</span>: <span class="string">"person"</span>,</span><br><span class="line">    <span class="attr">"_id"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="attr">"_version"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">"result"</span>: <span class="string">"updated"</span>,</span><br><span class="line">    <span class="attr">"_shards"</span>: &#123;</span><br><span class="line">        <span class="attr">"total"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"successful"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"_seq_no"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"_primary_term"</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如图所示：</p><p><img src="https://static.xkcoding.com/2018-01-17-15161741012942.jpg" alt="修改文档"></p><h3 id="4-5-删除"><a class="header-anchor" href="#4-5-删除"></a>4.5. 删除</h3><p>打开 PostMan，输入地址 <span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo5MjAwL3Blb3BsZS9wZXJzb24vMQ==" title="http://localhost:9200/people/person/1">http://localhost:9200/people/person/1<i class="fa fa-external-link"></i></span> ，将方法改为 <span style="color:red">DELETE</span> 方法，点击 Send。</p><p>返回值：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"_index"</span>: <span class="string">"people"</span>,</span><br><span class="line">    <span class="attr">"_type"</span>: <span class="string">"person"</span>,</span><br><span class="line">    <span class="attr">"_id"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="attr">"_version"</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">"result"</span>: <span class="string">"deleted"</span>,</span><br><span class="line">    <span class="attr">"_shards"</span>: &#123;</span><br><span class="line">        <span class="attr">"total"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"successful"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"_seq_no"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">"_primary_term"</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-6-查询"><a class="header-anchor" href="#4-6-查询"></a>4.6. 查询</h3><p>ES 正如其名，本就是为了 Search 而生，所以查询是 ES 最牛逼的地方。使用上面提到的插入语法，预先插入一堆原始数据，用 head 查看。</p><p><img src="https://static.xkcoding.com/2018-01-17-15161767712389.jpg" alt="预先插入的原始数据"></p><h4 id="简单查询"><a class="header-anchor" href="#简单查询"></a>简单查询</h4><p>打开 PostMan，输入地址 <span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo5MjAwL3Blb3BsZS9wZXJzb24vMQ==" title="http://localhost:9200/people/person/1">http://localhost:9200/people/person/1<i class="fa fa-external-link"></i></span> ，将方法改为 <span style="color:red">GET</span> 方法，点击 Send。</p><p>返回 id 为1的文档数据：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"_index"</span>: <span class="string">"people"</span>,</span><br><span class="line">    <span class="attr">"_type"</span>: <span class="string">"person"</span>,</span><br><span class="line">    <span class="attr">"_id"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="attr">"_version"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"found"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"_source"</span>: &#123;</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"xkcoding"</span>,</span><br><span class="line">        <span class="attr">"age"</span>: <span class="number">24</span>,</span><br><span class="line">        <span class="attr">"country"</span>: <span class="string">"中国"</span>,</span><br><span class="line">        <span class="attr">"birthday"</span>: <span class="string">"1994-11-22"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="条件查询"><a class="header-anchor" href="#条件查询"></a>条件查询</h4><p>这里还是使用 PostMan 来测试我们的条件查询</p><p>请求地址：<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo5MjAwL3Blb3BsZS9fc2VhcmNo" title="http://localhost:9200/people/_search">http://localhost:9200/people/_search<i class="fa fa-external-link"></i></span></p><p>请求方式：POST</p><div class="note danger"><p>返回值因为文章篇幅有限，就不将返回的内容贴在文章中了，请自行测试下方请求体，验证结果</p></div><ol><li><p>查询所有文档数据</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"query"</span>:&#123;</span><br><span class="line">		<span class="attr">"match_all"</span>:&#123;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>分页查询文档数据，第 0 条开始，每页 3 条数据</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"query"</span>:&#123;</span><br><span class="line">		<span class="attr">"match_all"</span>:&#123;&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"from"</span>:<span class="number">0</span>,</span><br><span class="line">	<span class="attr">"size"</span>:<span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>查询名字中包含「小」的文档</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"query"</span>:&#123;</span><br><span class="line">		<span class="attr">"match"</span>:&#123;</span><br><span class="line">			<span class="attr">"name"</span>:<span class="string">"小"</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>查询名字中包含「小」的文档，并且按照生日降序排序</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"query"</span>:&#123;</span><br><span class="line">		<span class="attr">"match"</span>:&#123;</span><br><span class="line">			<span class="attr">"name"</span>:<span class="string">"小"</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"sort"</span>:[</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="attr">"birthday"</span>:&#123;</span><br><span class="line">				<span class="attr">"order"</span>:<span class="string">"desc"</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="聚合查询"><a class="header-anchor" href="#聚合查询"></a>聚合查询</h4><p>请求地址：<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo5MjAwL3Blb3BsZS9fc2VhcmNo" title="http://localhost:9200/people/_search">http://localhost:9200/people/_search<i class="fa fa-external-link"></i></span></p><p>请求方式：POST</p><ol><li><p>按照年龄聚合数据，查出文档中不同年龄所占的人数</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"aggs"</span>:&#123;</span><br><span class="line">		<span class="attr">"group_by_age"</span>:&#123;</span><br><span class="line">			<span class="attr">"terms"</span>:&#123;</span><br><span class="line">				<span class="attr">"field"</span>:<span class="string">"age"</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>多个聚合，分别按照年龄、生日聚合数据</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"aggs"</span>:&#123;</span><br><span class="line">		<span class="attr">"group_by_age"</span>:&#123;</span><br><span class="line">			<span class="attr">"terms"</span>:&#123;</span><br><span class="line">				<span class="attr">"field"</span>:<span class="string">"age"</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">"group_by_birthday"</span>:&#123;</span><br><span class="line">			<span class="attr">"terms"</span>:&#123;</span><br><span class="line">				<span class="attr">"field"</span>:<span class="string">"birthday"</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>年龄最小</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"aggs"</span>:&#123;</span><br><span class="line">		<span class="attr">"grades_ages"</span>:&#123;</span><br><span class="line">			<span class="attr">"min"</span>:&#123;</span><br><span class="line">				<span class="attr">"field"</span>:<span class="string">"age"</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>年龄最大</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"aggs"</span>:&#123;</span><br><span class="line">		<span class="attr">"grades_ages"</span>:&#123;</span><br><span class="line">			<span class="attr">"max"</span>:&#123;</span><br><span class="line">				<span class="attr">"field"</span>:<span class="string">"age"</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>平均年龄</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"aggs"</span>:&#123;</span><br><span class="line">		<span class="attr">"grades_ages"</span>:&#123;</span><br><span class="line">			<span class="attr">"avg"</span>:&#123;</span><br><span class="line">				<span class="attr">"field"</span>:<span class="string">"age"</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>年龄总和</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"aggs"</span>:&#123;</span><br><span class="line">		<span class="attr">"grades_ages"</span>:&#123;</span><br><span class="line">			<span class="attr">"sum"</span>:&#123;</span><br><span class="line">				<span class="attr">"field"</span>:<span class="string">"age"</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>统计，将3、4、5、6的信息统一查询</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"aggs"</span>:&#123;</span><br><span class="line">		<span class="attr">"grades_ages"</span>:&#123;</span><br><span class="line">			<span class="attr">"stats"</span>:&#123;</span><br><span class="line">				<span class="attr">"field"</span>:<span class="string">"age"</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><hr><h2 id="5-高级查询"><a class="header-anchor" href="#5-高级查询"></a>5. 高级查询</h2><h3 id="5-1-query"><a class="header-anchor" href="#5-1-query"></a>5.1. query</h3><h4 id="模糊匹配"><a class="header-anchor" href="#模糊匹配"></a>模糊匹配</h4><p>查询名字中包含「小」的文档</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"query"</span>:&#123;</span><br><span class="line">		<span class="attr">"match"</span>:&#123;</span><br><span class="line">			<span class="attr">"name"</span>:<span class="string">"小"</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="词组匹配"><a class="header-anchor" href="#词组匹配"></a>词组匹配</h4><p>查询名字只包含「小凯」的文档，我们先使用如下的请求体查询</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"query"</span>:&#123;</span><br><span class="line">		<span class="attr">"match"</span>:&#123;</span><br><span class="line">			<span class="attr">"name"</span>:<span class="string">"小凯"</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>返回的结果：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">// 省略其余部分</span><br><span class="line">"hits": &#123;</span><br><span class="line">  "total": 3,</span><br><span class="line">  "max_score": 1.8386619,</span><br><span class="line">  "hits": [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"_index"</span>: <span class="string">"people"</span>,</span><br><span class="line">      <span class="attr">"_type"</span>: <span class="string">"person"</span>,</span><br><span class="line">      <span class="attr">"_id"</span>: <span class="string">"2"</span>,</span><br><span class="line">      <span class="attr">"_score"</span>: <span class="number">1.8386619</span>,</span><br><span class="line">      <span class="attr">"_source"</span>: &#123;</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"年轻的小凯"</span>,</span><br><span class="line">        <span class="attr">"age"</span>: <span class="number">14</span>,</span><br><span class="line">        <span class="attr">"country"</span>: <span class="string">"中国"</span>,</span><br><span class="line">        <span class="attr">"birthday"</span>: <span class="string">"2004-11-22"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"_index"</span>: <span class="string">"people"</span>,</span><br><span class="line">      <span class="attr">"_type"</span>: <span class="string">"person"</span>,</span><br><span class="line">      <span class="attr">"_id"</span>: <span class="string">"4"</span>,</span><br><span class="line">      <span class="attr">"_score"</span>: <span class="number">0.8984401</span>,</span><br><span class="line">      <span class="attr">"_source"</span>: &#123;</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"狂小狗"</span>,</span><br><span class="line">        <span class="attr">"age"</span>: <span class="number">20</span>,</span><br><span class="line">        <span class="attr">"country"</span>: <span class="string">"中国"</span>,</span><br><span class="line">        <span class="attr">"birthday"</span>: <span class="string">"1998-01-01"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"_index"</span>: <span class="string">"people"</span>,</span><br><span class="line">      <span class="attr">"_type"</span>: <span class="string">"person"</span>,</span><br><span class="line">      <span class="attr">"_id"</span>: <span class="string">"9"</span>,</span><br><span class="line">      <span class="attr">"_score"</span>: <span class="number">0.8142733</span>,</span><br><span class="line">      <span class="attr">"_source"</span>: &#123;</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"小泽"</span>,</span><br><span class="line">        <span class="attr">"age"</span>: <span class="number">32</span>,</span><br><span class="line">        <span class="attr">"country"</span>: <span class="string">"日本"</span>,</span><br><span class="line">        <span class="attr">"birthday"</span>: <span class="string">"1986-02-02"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过结果，可以发现，通过 match 去查询的时候，ES 返回的是分别包含「小」、「凯」的文档，如何去查询 name 字段只包含「小凯」的文档呢？使用 <strong>match_phrase</strong> 可以满足要求。</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"query"</span>:&#123;</span><br><span class="line">		<span class="attr">"match_phrase"</span>:&#123;</span><br><span class="line">			<span class="attr">"name"</span>:<span class="string">"小凯"</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="字段查询"><a class="header-anchor" href="#字段查询"></a>字段查询</h4><p>查询所有的中国人</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"query"</span>:&#123;</span><br><span class="line">		<span class="attr">"term"</span>:&#123;</span><br><span class="line">			<span class="attr">"country"</span>:<span class="string">"中国"</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="范围查询（支持数值型和日期型）"><a class="header-anchor" href="#范围查询（支持数值型和日期型）"></a>范围查询（支持数值型和日期型）</h4><p>查询年龄 24 ≤ age＜30 直接的数据</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"query"</span>:&#123;</span><br><span class="line">		<span class="attr">"range"</span>:&#123;</span><br><span class="line">			<span class="attr">"age"</span>:&#123;</span><br><span class="line">				<span class="attr">"gte"</span>:<span class="number">24</span>,</span><br><span class="line">				<span class="attr">"lt"</span>:<span class="number">30</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2-filter"><a class="header-anchor" href="#5-2-filter"></a>5.2. filter</h3><div class="note danger"><p>一般结合 bool 一起使用，</p></div><p>查询年龄为23的文档数据</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"query"</span>:&#123;</span><br><span class="line">		<span class="attr">"bool"</span>:&#123;</span><br><span class="line">			<span class="attr">"filter"</span>:&#123;</span><br><span class="line">				<span class="attr">"term"</span>:&#123;</span><br><span class="line">					<span class="attr">"age"</span>:<span class="number">23</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-3-复合条件查询"><a class="header-anchor" href="#5-3-复合条件查询"></a>5.3. 复合条件查询</h3><h4 id="固定分数查询"><a class="header-anchor" href="#固定分数查询"></a>固定分数查询</h4><ol><li><p>查询名字中包含「小」的文档，并固定查询分数</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"query"</span>:&#123;</span><br><span class="line">		<span class="attr">"constant_score"</span>:&#123;</span><br><span class="line">			<span class="attr">"filter"</span>:&#123;</span><br><span class="line">				<span class="attr">"match"</span>:&#123;</span><br><span class="line">					<span class="attr">"name"</span>:<span class="string">"小"</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>查询名字中包含「小」的文档，并固定查询分数为2</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"query"</span>:&#123;</span><br><span class="line">		<span class="attr">"constant_score"</span>:&#123;</span><br><span class="line">			<span class="attr">"filter"</span>:&#123;</span><br><span class="line">				<span class="attr">"match"</span>:&#123;</span><br><span class="line">					<span class="attr">"name"</span>:<span class="string">"小"</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="attr">"boost"</span>:<span class="number">2</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="布尔查询"><a class="header-anchor" href="#布尔查询"></a>布尔查询</h4><ol><li><p>查询是国家为中国或者年龄为30的数据</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"query"</span>:&#123;</span><br><span class="line">		<span class="attr">"bool"</span>:&#123;</span><br><span class="line">			<span class="attr">"should"</span>:[</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="attr">"match"</span>:&#123;</span><br><span class="line">						<span class="attr">"country"</span>:<span class="string">"中国"</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;,&#123;</span><br><span class="line">					<span class="attr">"match"</span>:&#123;</span><br><span class="line">						<span class="attr">"age"</span>:<span class="number">30</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;	</span><br><span class="line">			]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>查询国家为中国并且年龄为23的数据</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"query"</span>:&#123;</span><br><span class="line">		<span class="attr">"bool"</span>:&#123;</span><br><span class="line">			<span class="attr">"must"</span>:[</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="attr">"match"</span>:&#123;</span><br><span class="line">						<span class="attr">"country"</span>:<span class="string">"中国"</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;,&#123;</span><br><span class="line">					<span class="attr">"match"</span>:&#123;</span><br><span class="line">						<span class="attr">"age"</span>:<span class="number">23</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;	</span><br><span class="line">			]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>查询国家为中国并且年龄为23并且生日比1995-07-01早的数据</p><p>请求体：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"query"</span>:&#123;</span><br><span class="line">		<span class="attr">"bool"</span>:&#123;</span><br><span class="line">			<span class="attr">"must"</span>:[</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="attr">"match"</span>:&#123;</span><br><span class="line">						<span class="attr">"country"</span>:<span class="string">"中国"</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;,&#123;</span><br><span class="line">					<span class="attr">"match"</span>:&#123;</span><br><span class="line">						<span class="attr">"age"</span>:<span class="number">23</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;	</span><br><span class="line">			],</span><br><span class="line">			<span class="attr">"filter"</span>:[&#123;</span><br><span class="line">				<span class="attr">"range"</span>:&#123;</span><br><span class="line">					<span class="attr">"birthday"</span>:&#123;</span><br><span class="line">						<span class="attr">"lt"</span>:<span class="string">"1995-07-01"</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;]</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><hr><h2 id="6-Spring-Boot-集成-ES"><a class="header-anchor" href="#6-Spring-Boot-集成-ES"></a>6. Spring Boot 集成 ES</h2><div class="note success"><p>代码托管在 GitHub：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hrY29kaW5nL3NwcmluZy1ib290LWRlbW8vdHJlZS92LTEuNS54L3NwcmluZy1ib290LWRlbW8tZWxhc3RpY3NlYXJjaA==" title="https://github.com/xkcoding/spring-boot-demo/tree/v-1.5.x/spring-boot-demo-elasticsearch">戳我获取源码<i class="fa fa-external-link"></i></span></p></div><h3 id="6-1-Spring-Boot-集成-ES-的配置类"><a class="header-anchor" href="#6-1-Spring-Boot-集成-ES-的配置类"></a>6.1. Spring Boot 集成 ES 的配置类</h3><p>在 Spring Boot 中配置类需要使用 <code>@Configuration</code> 来标注</p><p><strong>application.yml</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">  context-path:</span> <span class="string">/demo</span></span><br><span class="line"><span class="attr">elasticsearch:</span></span><br><span class="line"><span class="attr">  host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">9300</span></span><br><span class="line"><span class="attr">  cluster:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">xkcoding</span></span><br></pre></td></tr></table></figure><p><strong>ElasticSearchConfig.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xkcoding.springbootdemoelasticsearch.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.transport.TransportClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.settings.Settings;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.transport.TransportAddress;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.transport.client.PreBuiltTransportClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.UnknownHostException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ES 的配置类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@package</span>: com.xkcoding.springbootdemoelasticsearch.config</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>： ES 的配置类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: yangkai.shen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: Created in 2018/1/18 下午4:41</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@copyright</span>: Copyright (c) 2018</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>: 0.0.1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@modified</span>: yangkai.shen</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ElasticSearchConfig</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"$&#123;elasticsearch.host&#125;"</span>)</span><br><span class="line">	<span class="keyword">private</span> String host;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"$&#123;elasticsearch.port&#125;"</span>)</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> port;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Value</span>(<span class="string">"$&#123;elasticsearch.cluster.name&#125;"</span>)</span><br><span class="line">	<span class="keyword">private</span> String clusterName;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> TransportClient <span class="title">esClient</span><span class="params">()</span> <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">		Settings settings = Settings.builder().put(<span class="string">"cluster.name"</span>, <span class="keyword">this</span>.clusterName).put(<span class="string">"client.transport.sniff"</span>, <span class="keyword">true</span>).build();</span><br><span class="line"></span><br><span class="line">		TransportAddress master = <span class="keyword">new</span> TransportAddress(InetAddress.getByName(host), port);</span><br><span class="line">		TransportClient client = <span class="keyword">new</span> PreBuiltTransportClient(settings).addTransportAddress(master);</span><br><span class="line">		<span class="keyword">return</span> client;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-2-插入"><a class="header-anchor" href="#6-2-插入"></a>6.2. 插入</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 插入一条数据到 ES 中，id 由 ES 生成</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name     名称</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> country  国籍</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> age      年龄</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> birthday 生日</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 插入数据的主键</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/person"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ApiResponse <span class="title">add</span><span class="params">(@RequestParam String name,</span></span></span><br><span class="line"><span class="function"><span class="params">                       @RequestParam String country,</span></span></span><br><span class="line"><span class="function"><span class="params">                       @RequestParam Integer age,</span></span></span><br><span class="line"><span class="function"><span class="params">                       @RequestParam @DateTimeFormat(pattern = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>)</span> Date birthday) </span>&#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		XContentBuilder content = XContentFactory.jsonBuilder()</span><br><span class="line">				.startObject()</span><br><span class="line">				.field(<span class="string">"name"</span>, name)</span><br><span class="line">				.field(<span class="string">"country"</span>, country)</span><br><span class="line">				.field(<span class="string">"age"</span>, age)</span><br><span class="line">				.field(<span class="string">"birthday"</span>, birthday.getTime())</span><br><span class="line">				.endObject();</span><br><span class="line"></span><br><span class="line">		IndexResponse response = esClient.prepareIndex(INDEX, TYPE).setSource(content).get();</span><br><span class="line">		<span class="keyword">return</span> ApiResponse.ofSuccess(response.getId());</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">		<span class="keyword">return</span> ApiResponse.ofStatus(Status.INTERNAL_SERVER_ERROR);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-3-修改"><a class="header-anchor" href="#6-3-修改"></a>6.3. 修改</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据主键，修改传递字段对应的值</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id       ES 中的 id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name     姓名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> country  国籍</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> age      年龄</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> birthday 生日</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> UPDATED 代表文档修改成功</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PutMapping</span>(<span class="string">"/person/&#123;id&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ApiResponse <span class="title">update</span><span class="params">(@PathVariable String id, </span></span></span><br><span class="line"><span class="function"><span class="params">                          @RequestParam(value = <span class="string">"name"</span>, required = <span class="keyword">false</span>)</span> String name, </span></span><br><span class="line"><span class="function">                          @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"country"</span>, required = <span class="keyword">false</span>)</span> String country, </span></span><br><span class="line"><span class="function">                          @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"age"</span>, required = <span class="keyword">false</span>)</span> Integer age, </span></span><br><span class="line"><span class="function">                          @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"birthday"</span>, required = <span class="keyword">false</span>)</span> @<span class="title">DateTimeFormat</span><span class="params">(pattern = <span class="string">"yyyy-MM-dd HH:mm:ss"</span>)</span> Date birthday) </span>&#123;</span><br><span class="line">	UpdateRequest request = <span class="keyword">new</span> UpdateRequest(INDEX, TYPE, id);</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		XContentBuilder builder = XContentFactory.jsonBuilder().startObject();</span><br><span class="line">		<span class="keyword">if</span> (!Strings.isNullOrEmpty(name)) &#123;</span><br><span class="line">			builder.field(<span class="string">"name"</span>, name);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (!Strings.isNullOrEmpty(country)) &#123;</span><br><span class="line">			builder.field(<span class="string">"country"</span>, country);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (age != <span class="keyword">null</span> &amp;&amp; age &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			builder.field(<span class="string">"age"</span>, age);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (birthday != <span class="keyword">null</span>) &#123;</span><br><span class="line">			builder.field(<span class="string">"birthday"</span>, birthday.getTime());</span><br><span class="line">		&#125;</span><br><span class="line">		builder.endObject();</span><br><span class="line">		request.doc(builder);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">		<span class="keyword">return</span> ApiResponse.ofStatus(Status.INTERNAL_SERVER_ERROR);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		UpdateResponse response = esClient.update(request).get();</span><br><span class="line">		<span class="keyword">return</span> ApiResponse.ofSuccess(response);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">		<span class="keyword">return</span> ApiResponse.ofStatus(Status.INTERNAL_SERVER_ERROR);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-4-删除"><a class="header-anchor" href="#6-4-删除"></a>6.4. 删除</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据 id 删除 ES 的一条记录</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id ES 中的 id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> DELETED 代表删除</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@DeleteMapping</span>(<span class="string">"/person/&#123;id&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ApiResponse <span class="title">delete</span><span class="params">(@PathVariable String id)</span> </span>&#123;</span><br><span class="line">	DeleteResponse response = esClient.prepareDelete(INDEX, TYPE, id).get();</span><br><span class="line">	<span class="keyword">return</span> ApiResponse.ofSuccess(response.getResult());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-5-简单查询"><a class="header-anchor" href="#6-5-简单查询"></a>6.5. 简单查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 简单查询 根据 id 查 ES 中的文档内容</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id ES 中存储的 id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 对应 id 的文档内容</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/person/&#123;id&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ApiResponse <span class="title">get</span><span class="params">(@PathVariable String id)</span> </span>&#123;</span><br><span class="line">	GetResponse response = esClient.prepareGet(INDEX, TYPE, id).get();</span><br><span class="line">	<span class="keyword">if</span> (!response.isExists() || response.isSourceEmpty()) &#123;</span><br><span class="line">		<span class="keyword">return</span> ApiResponse.ofStatus(Status.NOT_FOUND);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ApiResponse.ofSuccess(response.getSource());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-6-复合查询"><a class="header-anchor" href="#6-6-复合查询"></a>6.6. 复合查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 复合查询，根据传进来的条件，查询具体内容</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name    根据姓名匹配</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> country 根据国籍匹配</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> gtAge   大于年龄</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ltAge   小于年龄</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 满足条件的文档内容</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/person/query"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ApiResponse <span class="title">query</span><span class="params">(@RequestParam(value = <span class="string">"name"</span>, required = <span class="keyword">false</span>)</span> String name,</span></span><br><span class="line"><span class="function">                         @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"country"</span>, required = <span class="keyword">false</span>)</span> String country,</span></span><br><span class="line"><span class="function">                         @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"gt_age"</span>, defaultValue = <span class="string">"0"</span>)</span> <span class="keyword">int</span> gtAge,</span></span><br><span class="line"><span class="function">                         @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"lt_age"</span>, required = <span class="keyword">false</span>)</span> Integer ltAge) </span>&#123;</span><br><span class="line">	BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!Strings.isNullOrEmpty(name)) &#123;</span><br><span class="line">		boolQueryBuilder.must(QueryBuilders.matchQuery(<span class="string">"name"</span>, name));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!Strings.isNullOrEmpty(country)) &#123;</span><br><span class="line">		boolQueryBuilder.must(QueryBuilders.matchQuery(<span class="string">"country"</span>, country));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	RangeQueryBuilder rangeQueryBuilder = QueryBuilders.rangeQuery(<span class="string">"age"</span>).from(gtAge);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (ltAge != <span class="keyword">null</span> &amp;&amp; ltAge &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		rangeQueryBuilder.to(ltAge);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	boolQueryBuilder.filter(rangeQueryBuilder);</span><br><span class="line"></span><br><span class="line">	SearchRequestBuilder searchRequestBuilder = esClient.prepareSearch(INDEX)</span><br><span class="line">			.setTypes(TYPE)</span><br><span class="line">			.setSearchType(SearchType.DFS_QUERY_THEN_FETCH)</span><br><span class="line">			.setQuery(boolQueryBuilder)</span><br><span class="line">			.setFrom(<span class="number">0</span>)</span><br><span class="line">			.setSize(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">	log.info(<span class="string">"【query】:&#123;&#125;"</span>, searchRequestBuilder);</span><br><span class="line"></span><br><span class="line">	SearchResponse searchResponse = searchRequestBuilder.get();</span><br><span class="line">	List&lt;Map&lt;String, Object&gt;&gt; result = Lists.newArrayList();</span><br><span class="line">	searchResponse.getHits().forEach(hit -&gt; &#123;</span><br><span class="line">		result.add(hit.getSourceAsMap());</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ApiResponse.ofSuccess(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-8-搜索建议（有时间补充）"><a class="header-anchor" href="#6-8-搜索建议（有时间补充）"></a>6.8. 搜索建议（有时间补充）</h3><h3 id="6-7-聚合查询（有时间补充）"><a class="header-anchor" href="#6-7-聚合查询（有时间补充）"></a>6.7. 聚合查询（有时间补充）</h3><h2 id="7-结语"><a class="header-anchor" href="#7-结语"></a>7. 结语</h2><p>ElasticSearch 在现在是一个应用十分广泛，且火热的技术，本文只是我在入门 ES 的一点小小的记录，更多 ES 的专业知识，优化技巧，还需要大量的学习与实践！</p><p>推荐学习地址：</p><ol><li>官方文档：<span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxhc3RpYy5jby9ndWlkZS9lbi9lbGFzdGljc2VhcmNoL3JlZmVyZW5jZS9jdXJyZW50L2dldHRpbmctc3RhcnRlZC5odG1s" title="https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started.html<i class="fa fa-external-link"></i></span></li><li>Elastic 中文社区：<span class="exturl" data-url="aHR0cHM6Ly9lbGFzdGljc2VhcmNoLmNuLw==" title="https://elasticsearch.cn/">https://elasticsearch.cn/<i class="fa fa-external-link"></i></span></li></ol></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束&nbsp;<i class="fa fa-paw"></i>&nbsp;感谢您的阅读-------------</div></div></div><div><div id="wechat_subscriber" style="display:block;padding:10px 0;margin:20px auto;width:100%;text-align:center"> <img id="wechat_subscriber_qcode" src="/images/qrcode_for_xkcoding.jpg" alt="xkcoding wechat" style="width:200px;max-width:100%"><div>欢迎来我的公众号「xkcoding小凯扣丁」逛逛</div></div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>o(╯□╰)o 赞助一杯咖啡 ~~</div> <button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'> <span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"> <img id="wechat_qr" src="/resources/wechat-reward-image.png" alt="xkcoding 微信支付"><p>微信支付</p></div><div id="alipay" style="display:inline-block"> <img id="alipay_qr" src="/resources/alipay-reward-image.png" alt="xkcoding 支付宝"><p>支付宝</p></div></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> xkcoding</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://xkcoding.com/2018/01/12/elasticsearch_note.html" title="ElasticSearch 笔记">https://xkcoding.com/2018/01/12/elasticsearch_note.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/java/" rel="tag"><i class="fa fa-tag"></i> java</a><a href="/tags/elasticsearch/" rel="tag"><i class="fa fa-tag"></i> elasticsearch</a></div><div class="post-widgets"><div class="social_share"><div id="needsharebutton-postbottom"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2018/01/11/camelcase-underline-transform.html" rel="next" title="驼峰命名和下划线命名互相转化"><i class="fa fa-chevron-left"></i> 驼峰命名和下划线命名互相转化</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/2018/01/16/db-page-sqls.html" rel="prev" title="关于 MSSQL/MYSQL/ORACLE 的分页语句">关于 MSSQL/MYSQL/ORACLE 的分页语句<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><div class="comments" id="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="xkcoding"><p class="site-author-name" itemprop="name">xkcoding</p><p class="site-description motion-element" itemprop="description">xkcoding的代码成长日记</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">86</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">39</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">57</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hrY29kaW5n" title="GitHub &rarr; https://github.com/xkcoding"><i class="fa fa-fw fa-github"></i> GitHub</span></span><span class="links-of-author-item"><span class="exturl" data-url="bWFpbHRvOjIzNzQ5NzgxOUBxcS5jb20=" title="邮箱 &rarr; mailto:237497819@qq.com"><i class="fa fa-fw fa-envelope"></i> 邮箱</span></span><span class="links-of-author-item"><span class="exturl" data-url="dGVuY2VudDovL21lc3NhZ2UvP21lbnU9eWVzJnVpbj0yMzc0OTc4MTkmd2Vic2l0ZW5hbWU9aW0ucXEuY29t" title="QQ &rarr; tencent://message/?menu=yes&uin=237497819&websitename=im.qq.com"><i class="fa fa-fw fa-qq"></i> QQ</span></span><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly93d3cud2VpYm8uY29tL3hrY29kaW5n" title="微博 &rarr; https://www.weibo.com/xkcoding"><i class="fa fa-fw fa-weibo"></i> 微博</span></span><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9jaGVuLXlhbmcta2FpLTYyL2FjdGl2aXRpZXM=" title="知乎 &rarr; https://www.zhihu.com/people/chen-yang-kai-62/activities"><i class="fa fa-fw fa-globe"></i> 知乎</span></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS &rarr; /atom.xml"><i class="fa fa-fw fa-rss"></i> RSS</a></span></div><div class="cc-license motion-element" itemprop="license"> <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></span></div><div class="site-author motion-element"> <img class="mp-image" src="/images/qrcode_for_xkcoding.jpg" alt="xkcoding小凯扣丁"><p class="site-description">xkcoding小凯扣丁</p><p class="site-description motion-element">欢迎来我的公众号逛逛！</p></div></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-安装"><span class="nav-text">1. 安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-单机安装"><span class="nav-text">1.1. 单机安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-分布式安装"><span class="nav-text">1.2. 分布式安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-插件安装"><span class="nav-text">1.3. 插件安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-1-head-插件"><span class="nav-text">1.3.1. head 插件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#独立安装"><span class="nav-text">独立安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#集成安装"><span class="nav-text">集成安装</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-2-ik-中文分词插件"><span class="nav-text">1.3.2. ik 中文分词插件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#手动安装"><span class="nav-text">手动安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#自动安装"><span class="nav-text">自动安装</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-常见错误"><span class="nav-text">2. 常见错误</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#错误1：进程虚拟内存"><span class="nav-text">错误1：进程虚拟内存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#错误2：文件权限不足"><span class="nav-text">错误2：文件权限不足</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重启终端窗口"><span class="nav-text">重启终端窗口</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-基础概念"><span class="nav-text">3. 基础概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-集群和节点"><span class="nav-text">3.1. 集群和节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-索引"><span class="nav-text">3.2. 索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-类型"><span class="nav-text">3.3. 类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-文档"><span class="nav-text">3.4. 文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-分片"><span class="nav-text">3.5. 分片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-备份"><span class="nav-text">3.6. 备份</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-基本用法"><span class="nav-text">4. 基本用法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-请求方式"><span class="nav-text">4.1. 请求方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-索引"><span class="nav-text">4.2. 索引</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建"><span class="nav-text">创建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#删除"><span class="nav-text">删除</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-插入"><span class="nav-text">4.3. 插入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#指定-ID-插入"><span class="nav-text">指定 ID 插入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#不指定-ID-插入"><span class="nav-text">不指定 ID 插入</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-修改"><span class="nav-text">4.4. 修改</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-删除"><span class="nav-text">4.5. 删除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6-查询"><span class="nav-text">4.6. 查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#简单查询"><span class="nav-text">简单查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#条件查询"><span class="nav-text">条件查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#聚合查询"><span class="nav-text">聚合查询</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-高级查询"><span class="nav-text">5. 高级查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-query"><span class="nav-text">5.1. query</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#模糊匹配"><span class="nav-text">模糊匹配</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#词组匹配"><span class="nav-text">词组匹配</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#字段查询"><span class="nav-text">字段查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#范围查询（支持数值型和日期型）"><span class="nav-text">范围查询（支持数值型和日期型）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-filter"><span class="nav-text">5.2. filter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-复合条件查询"><span class="nav-text">5.3. 复合条件查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#固定分数查询"><span class="nav-text">固定分数查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#布尔查询"><span class="nav-text">布尔查询</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-Spring-Boot-集成-ES"><span class="nav-text">6. Spring Boot 集成 ES</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-Spring-Boot-集成-ES-的配置类"><span class="nav-text">6.1. Spring Boot 集成 ES 的配置类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-插入"><span class="nav-text">6.2. 插入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-修改"><span class="nav-text">6.3. 修改</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-4-删除"><span class="nav-text">6.4. 删除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-5-简单查询"><span class="nav-text">6.5. 简单查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-6-复合查询"><span class="nav-text">6.6. 复合查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-8-搜索建议（有时间补充）"><span class="nav-text">6.8. 搜索建议（有时间补充）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-7-聚合查询（有时间补充）"><span class="nav-text">6.7. 聚合查询（有时间补充）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-结语"><span class="nav-text">7. 结语</span></a></li></ol></div></div></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright"> <span class="exturl" data-url="aHR0cDovL2JlaWFuLm1paXQuZ292LmNuLw==">浙ICP备15019787号-1</span> &copy; 2015 – <span itemprop="copyrightYear">2022</span><span class="with-love" id="animate"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">xkcoding</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span class="post-meta-item-text">站点总字数：</span> <span title="站点总字数">549k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">8:19</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item-icon"><i class="fa fa-user"></i> 访客数:</span><span class="site-uv" title="总访客量"><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i> 阅读量:</span><span class="site-pv" title="总访问量"><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script src="/lib/jquery/index.js?v=2.1.3"></script><script src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script src="/lib/reading_progress/reading_progress.js"></script><script src="/js/src/utils.js?v=7.0.0"></script><script src="/js/src/motion.js?v=7.0.0"></script><script src="/js/src/schemes/muse.js?v=7.0.0"></script><script src="/js/src/scrollspy.js?v=7.0.0"></script><script src="/js/src/post-details.js?v=7.0.0"></script><script src="/js/src/bootstrap.js?v=7.0.0"></script><script>var disqus_config=function(){this.page.url="https://xkcoding.com/2018/01/12/elasticsearch_note.html",this.page.identifier="2018/01/12/elasticsearch_note.html",this.page.title="ElasticSearch 笔记"};function loadComments(){var t=document,e=t.createElement("script");e.src="https://dai-ma-ri-ji.disqus.com/embed.js",e.setAttribute("data-timestamp",""+ +new Date),(t.head||t.body).appendChild(e)}$(function(){$("#comments").offset().top-$(window).height()<=0?loadComments():$(window).on("scroll.disqus_scroll",function(){$("#comments").offset().top-$(window).height()-$(window).scrollTop()<60&&($(window).off(".disqus_scroll"),loadComments())})})</script><script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      
        // ref: https://github.com/ForbesLindesay/unescape-html
        var unescapeHtml = function(html) {
          return String(html)
            .replace(/&quot;/g, '"')
            .replace(/&#39;/g, '\'')
            .replace(/&#x3A;/g, ':')
            // replace all the other &#x; chars
            .replace(/&#(\d+);/g, function (m, p) { return String.fromCharCode(p); })
            .replace(/&lt;/g, '<')
            .replace(/&gt;/g, '>')
            .replace(/&amp;/g, '&');
        };
      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                content = unescapeHtml(content);
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><script>
    
    function addCount(Counter) {
      var $visitors = $('.leancloud_visitors');
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url }) })
        .done(function({ results }) {
          if (results.length > 0) {
            var counter = results[0];
            
            Counter('put', '/classes/Counter/' + counter.objectId, JSON.stringify({ time: { '__op': 'Increment', 'amount': 1 } }))
            
              .done(function() {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.time + 1);
              })
            
              .fail(function ({ responseJSON }) {
                console.log(`Failed to save Visitor num, with error message: ${responseJSON.error}`);
              })
          } else {
            
              Counter('post', '/classes/Counter', JSON.stringify({ title: title, url: url, time: 1 }))
                .done(function() {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(1);
                })
                .fail(function() {
                  console.log('Failed to create');
                });
            
          }
        })
        .fail(function ({ responseJSON }) {
          console.log(`LeanCloud Counter Error: ${responseJSON.code} ${responseJSON.error}`);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'igdqTfV9rbtm7WF3pmcBo0fM-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'igdqTfV9rbtm7WF3pmcBo0fM-gzGzoHsz',
                'X-LC-Key': 'qJ9XOC1VMiPdYow77o4YVWMN',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            addCount(Counter);
          
        });
    });
  </script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/lib/needsharebutton/needsharebutton.js"></script><script>pbOptions={iconStyle:"default",boxForm:"horizontal",position:"bottomCenter",networks:"QQZone,Wechat,Weibo,Douban,Mailto,Evernote,Twitter,Facebook"},new needShareButton("#needsharebutton-postbottom",pbOptions),flOptions={iconStyle:"default",boxForm:"vertical",position:"middleRight",networks:"QQZone,Wechat,Weibo,Douban,Mailto,Evernote,Twitter,Facebook"},new needShareButton("#needsharebutton-float",flOptions)</script><script src="/lib/pangu/dist/pangu.min.js?v=3.3"></script><script>pangu.spacingPage()</script><script src="/js/src/js.cookie.js?v=7.0.0"></script><script src="/js/src/scroll-cookie.js?v=7.0.0"></script><script src="/js/src/exturl.js?v=7.0.0"></script><script src="/lib/bookmark/bookmark.min.js?v=1.0"></script><script>bookmark.scrollToMark("auto","#更多")</script><style>.copy-btn{display:inline-block;padding:6px 12px;font-size:13px;font-weight:700;line-height:20px;color:#333;white-space:nowrap;vertical-align:middle;cursor:pointer;background-color:#eee;background-image:linear-gradient(#fcfcfc,#eee);border:1px solid #d5d5d5;border-radius:3px;user-select:none;outline:0}.highlight-wrap .copy-btn{transition:opacity .3s ease-in-out;opacity:0;padding:2px 6px;position:absolute;right:4px;top:8px}.highlight-wrap .copy-btn:focus,.highlight-wrap:hover .copy-btn{opacity:1}.highlight-wrap{position:relative}</style><script>$(".highlight").each(function(e,t){var n=$("<div>").addClass("highlight-wrap");$(t).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(e){var t=$(this).parent().find(".code").find(".line").map(function(e,t){return $(t).text()}).toArray().join("\n"),n=document.createElement("textarea"),o=document.createRange(),a=window.getSelection(),i=window.pageYOffset||document.documentElement.scrollTop;n.style.top=i+"px",n.style.position="absolute",n.style.opacity="0",n.value=t,n.textContent=t,n.contentEditable=!0,n.readOnly=!1,document.body.appendChild(n),o.selectNode(n),a.removeAllRanges(),a.addRange(o),n.setSelectionRange(0,t.length),document.execCommand("copy")?$(this).text("复制成功"):$(this).text("复制失败"),n.blur(),$(this).blur()})).on("mouseleave",function(e){var t=$(this).find(".copy-btn");setTimeout(function(){t.text("复制")},300)}).append(t)})</script><script type="text/javascript" src="/js/clicklove.js"></script></body></html>